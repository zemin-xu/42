/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   rush-01.c                                          :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: mibouroi <marvin@42.fr>                    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2019/06/15 14:48:56 by mibouroi          #+#    #+#             */
/*   Updated: 2019/06/16 15:25:58 by zexu             ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>


int tab_all[24][4] = {{1,2,3,4},{1,2,4,3},{1,3,4,2},{2,3,4,1},{2,1,3,4},{2,3,1,4},{1,3,2,4},{1,4,2,3}, {1,4,3,2}, {2,1,4,3},{2,4,1,3},{2,4,3,1},{3,1,2,4},{3,1,4,2},{3,2,1,4},{3,2,4,1},{3,4,1,2},{3,4,2,1},{4,1,2,3},{4,1,3,2},{4,2,1,3},{4,2,3,1},{4,3,1,2},{4,3,2,1}};

int	*p_lib = &tab_all[0][0];
int		show_possibility(int nb)
{
	if(nb == 4)
		return (1);
	else if (nb == 3)
		return (6);
	else if (nb == 2)
		return (11);
	else if (nb == 1)
		return (6);
	else
		return (0);
}
int		position(int param)
{
	if(param == 4)
		return (1);
	if(param == 3)
		return (2);
	if(param == 2)
		return (8);
	if(param == 1)
		return (19);
	else
		return (0);
}
int		*show_one_line(int *tab, int index)
{
	return (tab + (index - 1) * 4);
}

int		all_solution(int *tab_params, int *p_lib, int *all)
{
	int i,j,k,l;
	int total = 0;
	i = j = k = l = 0;
	int	max = 14641;

	int *buffer;
	buffer = (int*)malloc (max*16* sizeof(int));
	while(i < show_possibility(*(tab_params+0)))
	{
		while(j < show_possibility(*(tab_params+1)))
		{
			while(k < show_possibility(*(tab_params+2)))
			{
				while(l < show_possibility(*(tab_params+3)))
				{
					for(int m = 0; m<4; m++)
						*(buffer + total*16 + m) = *(show_one_line((p_lib + 4 * position(*(tab_params + 0))), i) + m);
					for(int m = 4; m<8; m++)
						*(buffer + total*16 + m) = *(show_one_line((p_lib + 4 * position(*(tab_params + 1))), j) + m -4);
					for(int m = 8; m<12; m++)
						*(buffer + total*16 + m) = *(show_one_line((p_lib + 4 * position(*(tab_params + 2))), k) + m - 8);
					for(int m = 12; m<16; m++)
						*(buffer + total*16 + m) = *(show_one_line((p_lib + 4 * position(*(tab_params + 3))), l) + m - 12);
					total++;
					l++;
				}
				k++;
				l = 0;
			}
			j++;
			k = 0;
			l = 0;
		}	
		i++;
		j = 0;
		k = 0;
		l = 0;
	}
	for(int q = 0; q < total; q++)
	{
		for(int r = 0; r< 16; r++)
		{
			*(all + q * 16 + r) = *(buffer + q * 16 + r);
		}
	}
	return (total);
}
void	ft_swap(int *a, int *b)
{
	int	tmp;

	tmp = *a;
	*a = *b;
	*b = tmp;
}

void	ft_sort_int_tab(int *tab, int size)
{
	int	i;
	int	has_sorted;

	while(1)
	{
		has_sorted = 0;
		i = 0;
		while (i < size - 1)
		{
			if(*(tab + i) > *(tab + i + 1))
			{

				ft_swap((tab + i), (tab + i +1));
				has_sorted = 1;
			}
			i++;
		}
		if (has_sorted == 0)
			break;
	}
}
int		total_is_1234(int *src, int count, int *res)
{
	int *buffer = (int*)malloc(count * 4 * 4 * sizeof(int));
	int counter = 0;	
	int flag;
	for(int m = 0; m < count; m++)
	{
		flag = 0;
		for(int i = 0; i < 4; i++)
		{
			*(buffer + m * 16 + 4 * i + 0) = *(src + m * 16 + 4 * i+ 0);	
			*(buffer + m * 16 + 4 * i + 1) = *(src + m* 16 + 4 * i+ 1);	
			*(buffer + m * 16 + 4 * i + 2) = *(src + m* 16 + 4 * i+ 2);	
			*(buffer + m * 16 + 4 * i + 3) = *(src + m* 16 + 4 * i+ 3);	
			ft_sort_int_tab((buffer + m* 16 + 4 * i), 4);
			if( *(buffer + m* 16 + 4 * i) == 1 && *(buffer + m* 16 + 4 * i + 1) == 2
					&& *(buffer + m* 16 + 4 * i + 2) == 3 && *(buffer + m* 16 + 4 * i + 3) == 4)	
			{
				flag++;
			}
		}
		if(flag == 4)
		{
			for(int j = 0; j < 16; j++)
			{
				*(res + counter * 16 + j) = *(src + m * 16 + j);
			}
			counter++;
		}
	}
	return (counter);
}
int			compare_lib(int *lib, int *src, int count, int *tab_params, int params_index)
{

	int counter = 0;
	int flag_general;
	int flag;
	int *new = (int*)malloc(count * 16 * sizeof(int));

	for(int i = 0; i < count; i++)
	{
		flag_general = 0;
		for(int j = 0; j < 4; j++)
		{
			flag = 0;
			for(int l = 0; l < show_possibility(*(tab_params + params_index)); l++)
			{
				if( *(src + i * 16 + 4*j + 0) == *(lib + (position(*(tab_params + params_index + j))) + 0))
					flag++;	
				if( *(src + i * 16 + 4*j + 1) == *(lib + (position(*(tab_params + params_index + j))) + 1))
					flag++;	
				if( *(src + i * 16 + 4*j + 2) == *(lib + (position(*(tab_params + params_index + j))) + 2))
					flag++;	
				if( *(src + i * 16 + 4*j + 3) == *(lib + (position(*(tab_params + params_index + j))) + 3))
					flag++;	
				printf("current num: %d, compare with: %d", *(src + i * 16 + 4*j + 0) , *(lib + (position(*(tab_params + params_index + j))) + 0));
				printf("flag : %d, flag general: %d\n", flag, flag_general);
				if(flag == 4)
				{
					flag_general++;	
					break;
				}
			}

			if(flag_general == 4)
			{
				for(int m = 0; m < 16; m++)
				{
					*(new + counter * 16 + m) = *(src + i * 16 + m);
					printf("%d  ", *(src + i * 16 + m));
				}
				counter++;
			}
		}
	}
	return (counter);
}

int			selection_left(int *all, int count)
{
	int *buffer = (int*)malloc(count*16* sizeof(int)); 

	for(int i = 0; i<count; i++)
	{
		int counter = 0;
		for(int j = 0; j< 13; j+= 4,counter++)
			*(buffer + i * 16 + counter) = *(all + i * 16 + j);			

		for(int j = 1; j< 14; j+= 4,counter++)
			*(buffer + i * 16 + counter) = *(all + i * 16 + j);			

		for(int j = 2; j< 15; j+= 4,counter++)
			*(buffer + i * 16 + counter) = *(all + i * 16 + j);			

		for(int j = 3; j< 16; j+= 4,counter++)
			*(buffer + i * 16 + counter) = *(all + i * 16 + j);			
	}

	int *new = (int*)malloc(count * 16 * sizeof(int));
	int	new_count = total_is_1234(buffer, count, new);

	for(int i = 0; i< new_count; i++)
	{
		for(int j = 0; j < 16; j++)
		{
			*(all + i * 16 + j) = *(new + i * 16 + j);
		}
	}
	return (new_count);
}

int main(int argc, char *argv[])
{

	(void)argc;
	int i;
	i = 1;
	int tab_params[argc - 1];

	while (argv[i])
	{
		tab_params[i - 1] = atoi(argv[i]);
		i++;
	}
	int count;
	int *all = (int *)malloc(14641* 16 * sizeof(int));
	count = all_solution(tab_params, p_lib,all);
	count = selection_left(all, count);
/*
	for(int q = 0; q < count; q++)
	{
		for(int r = 0; r< 16; r++)
		{
			printf(" %d  ", *(all+ q* 16 +r));
		}
		printf("\nchange line : %d\n" ,q);
	}
	printf("total : %d", count);
*/
	compare_lib(p_lib, all, count, tab_params,4);
	free(all);
	return 0;


}
